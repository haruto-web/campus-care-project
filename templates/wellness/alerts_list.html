{% extends 'counselor_base.html' %}

{% block page_title %}Alerts & Notifications{% endblock %}

{% block page_css %}
<style>
    .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }
    
    .alert-item {
        padding: 20px;
        background: white;
        border-radius: 12px;
        border-left: 4px solid;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .alert-item.critical { border-left-color: #e53e3e; background: linear-gradient(to right, #fff5f5 0%, white 100%); }
    .alert-item.high { border-left-color: #dd6b20; background: linear-gradient(to right, #fffaf0 0%, white 100%); }
    .alert-item.medium { border-left-color: #3182ce; background: linear-gradient(to right, #ebf8ff 0%, white 100%); }
    .alert-item.low { border-left-color: #718096; background: #f7fafc; }
    
    .warning-banner {
        background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block page_content %}
{% if critical_unread > 0 or high_unread > 0 %}
<div class="warning-banner">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <strong>Warning!</strong> You have 
    {% if critical_unread > 0 %}<strong>{{ critical_unread }} critical</strong>{% endif %}
    {% if critical_unread > 0 and high_unread > 0 %} and {% endif %}
    {% if high_unread > 0 %}<strong>{{ high_unread }} high severity</strong>{% endif %}
    unread alert(s) that require immediate attention.
</div>
{% endif %}

<div class="card mb-3">
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <select name="type" class="form-select">
                <option value="">All Types</option>
                <option value="high_risk" {% if alert_type == 'high_risk' %}selected{% endif %}>High Risk Student</option>
                <option value="missing_assignments" {% if alert_type == 'missing_assignments' %}selected{% endif %}>Missing Assignments</option>
                <option value="low_attendance" {% if alert_type == 'low_attendance' %}selected{% endif %}>Low Attendance</option>
                <option value="wellness_concern" {% if alert_type == 'wellness_concern' %}selected{% endif %}>Wellness Concern</option>
                <option value="teacher_concern" {% if alert_type == 'teacher_concern' %}selected{% endif %}>Teacher Concern</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="severity" class="form-select">
                <option value="">All Severity</option>
                <option value="critical" {% if severity_filter == 'critical' %}selected{% endif %}>Critical</option>
                <option value="high" {% if severity_filter == 'high' %}selected{% endif %}>High</option>
                <option value="medium" {% if severity_filter == 'medium' %}selected{% endif %}>Medium</option>
                <option value="low" {% if severity_filter == 'low' %}selected{% endif %}>Low</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="resolved" class="form-select">
                <option value="">Hide Resolved</option>
                <option value="true" {% if show_resolved == 'true' %}selected{% endif %}>Show Resolved</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>
    </form>
</div>

{% for alert in alerts %}
<div class="alert-item {{ alert.severity|lower }}">
    <div class="d-flex justify-content-between align-items-start">
        <div style="flex: 1;">
            <h6 style="margin: 0 0 8px 0; color: #2d3748; font-size: 15px;">
                {{ alert.get_alert_type_display }}
                <span class="badge" style="background: {% if alert.severity == 'critical' %}#fc8181{% elif alert.severity == 'high' %}#f6ad55{% elif alert.severity == 'medium' %}#4299e1{% else %}#a0aec0{% endif %}; color: white; font-size: 11px;">{{ alert.get_severity_display }}</span>
                {% if not alert.is_read %}<span class="badge" style="background: #4fd1c5; color: white; font-size: 11px;">New</span>{% endif %}
                {% if alert.resolved %}<span class="badge" style="background: #68d391; color: white; font-size: 11px;">Resolved</span>{% endif %}
            </h6>
            <p style="margin: 0 0 8px 0; color: #718096; font-size: 14px;">{{ alert.message }}</p>
            <small style="color: #a0aec0;">
                <a href="{% url 'student_profile' alert.student.id %}" style="color: #4fd1c5; text-decoration: none;">{{ alert.student.get_full_name }}</a>
                | {{ alert.created_at|date:"M d, Y g:i A" }}
            </small>
        </div>
        {% if not alert.resolved %}
        <div style="display: flex; gap: 8px;">
            {% if not alert.is_read %}
            <a href="{% url 'wellness:mark_alert_read' alert.id %}" class="btn btn-sm btn-outline-primary">Mark Read</a>
            {% endif %}
            <a href="{% url 'wellness:resolve_alert' alert.id %}" class="btn btn-sm btn-success">Resolve</a>
        </div>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="card">
    <div style="text-align: center; padding: 40px; color: #718096;">
        No alerts found.
    </div>
</div>
{% endfor %}
{% endblock %}
