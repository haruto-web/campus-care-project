{% extends 'base.html' %}
{% block title %}Messages{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto space-y-4">
    <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800">Messages</h2>
        <a href="{% url 'messaging:new_message' %}"
           class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold text-sm">
            <i class="bi bi-pencil-square"></i> New Message
        </a>
    </div>

    {% if conversations %}
    <div class="bg-white rounded-xl shadow divide-y divide-gray-100">
        {% for item in conversations %}
        <a href="{% url 'messaging:conversation' item.conv.id %}"
           class="flex items-center gap-4 px-5 py-4 hover:bg-gray-50 transition {% if item.unread %}bg-blue-50{% endif %}">
            <div class="w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white font-bold text-base flex-shrink-0">
                {{ item.other.first_name|first|upper }}{{ item.other.last_name|first|upper }}
            </div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between">
                    <p class="font-semibold text-gray-800 {% if item.unread %}text-blue-700{% endif %}">
                        {{ item.other.get_full_name }}
                        <span class="text-xs font-normal text-gray-400 ml-1 capitalize">({{ item.other.role }})</span>
                    </p>
                    <span class="text-xs text-gray-400 flex-shrink-0 ml-2">
                        {% if item.last_msg %}{{ item.last_msg.created_at|date:"M d, g:i A" }}{% endif %}
                    </span>
                </div>
                <p class="text-sm text-gray-500 truncate">
                    {% if item.last_msg %}
                        {% if item.last_msg.sender == request.user %}<span class="text-gray-400">You: </span>{% endif %}
                        {{ item.last_msg.body }}
                    {% else %}No messages yet{% endif %}
                </p>
            </div>
            {% if item.unread %}
            <span class="flex-shrink-0 w-5 h-5 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold">
                {{ item.unread }}
            </span>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-xl shadow p-10 text-center text-gray-400">
        <i class="bi bi-chat-dots text-5xl mb-3 block"></i>
        <p class="font-medium">No conversations yet.</p>
        <a href="{% url 'messaging:new_message' %}" class="mt-3 inline-block text-blue-600 hover:underline text-sm">Start a new message</a>
    </div>
    {% endif %}
</div>
{% endblock %}
