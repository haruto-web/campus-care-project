{% extends 'base.html' %}

{% block title %}{{ class.name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Class Header with Gradient -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-lg p-6 sm:p-8 text-white">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4">
            <div>
                <h2 class="text-2xl sm:text-3xl font-bold mb-2">{{ class.code }}</h2>
                <p class="text-lg sm:text-xl text-blue-100 mb-2">{{ class.name }}</p>
                <p class="text-blue-100 text-sm">{{ class.description }}</p>
            </div>
            <div class="sm:text-right">
                <div class="bg-white/20 backdrop-blur rounded-lg px-4 py-2 inline-block">
                    <p class="text-sm text-blue-100">Students Enrolled</p>
                    <p class="text-3xl font-bold">{{ class.students.count }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Bar -->
    <div class="bg-white rounded-lg shadow p-3 sm:p-4">
        <div class="flex flex-wrap gap-2">
            {% if user.role == 'teacher' and class.teacher == user %}
            <a href="{% url 'academics:edit_class' class.id %}" class="flex items-center gap-1.5 bg-gray-600 text-white px-3 py-2 rounded-lg hover:bg-gray-700 transition text-sm">
                <i class="bi bi-pencil"></i> <span class="hidden sm:inline">Edit Class</span><span class="sm:hidden">Edit</span>
            </a>
            <a href="{% url 'academics:manage_students' class.id %}" class="flex items-center gap-1.5 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
                <i class="bi bi-people"></i> <span class="hidden sm:inline">Manage Students</span><span class="sm:hidden">Students</span>
            </a>
            <a href="{% url 'academics:create_assignment' class.id %}" class="flex items-center gap-1.5 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition text-sm">
                <i class="bi bi-plus-circle"></i> <span class="hidden sm:inline">New Assignment</span><span class="sm:hidden">Assign</span>
            </a>
            <a href="{% url 'academics:mark_attendance' class.id %}" class="flex items-center gap-1.5 bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition text-sm">
                <i class="bi bi-check2-square"></i> <span class="hidden sm:inline">Mark Attendance</span><span class="sm:hidden">Attend</span>
            </a>
            <a href="{% url 'academics:create_announcement' class.id %}" class="flex items-center gap-1.5 bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition text-sm">
                <i class="bi bi-megaphone"></i> <span class="hidden sm:inline">Post Announcement</span><span class="sm:hidden">Announce</span>
            </a>
            <a href="{% url 'academics:upload_material' class.id %}" class="flex items-center gap-1.5 bg-indigo-600 text-white px-3 py-2 rounded-lg hover:bg-indigo-700 transition text-sm">
                <i class="bi bi-upload"></i> <span class="hidden sm:inline">Upload Material</span><span class="sm:hidden">Upload</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Class Info Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
            <div class="flex items-center gap-3">
                <div class="bg-blue-100 p-3 rounded-lg">
                    <i class="bi bi-person text-2xl text-blue-600"></i>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Teacher</p>
                    <p class="font-semibold text-gray-800">{{ class.teacher.get_full_name }}</p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
            <div class="flex items-center gap-3">
                <div class="bg-green-100 p-3 rounded-lg">
                    <i class="bi bi-calendar text-2xl text-green-600"></i>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Semester</p>
                    <p class="font-semibold text-gray-800">{{ class.semester }}</p>
                </div>
            </div>
        </div>
        {% if class.schedule %}
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
            <div class="flex items-center gap-3">
                <div class="bg-purple-100 p-3 rounded-lg">
                    <i class="bi bi-clock text-2xl text-purple-600"></i>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Schedule</p>
                    <p class="font-semibold text-gray-800">{{ class.schedule }}</p>
                </div>
            </div>
        </div>
        {% endif %}
        {% if class.room %}
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
            <div class="flex items-center gap-3">
                <div class="bg-yellow-100 p-3 rounded-lg">
                    <i class="bi bi-door-open text-2xl text-yellow-600"></i>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Room</p>
                    <p class="font-semibold text-gray-800">{{ class.room }}</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Announcements Section -->
    <div class="bg-white rounded-lg shadow">
        <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-lg font-semibold flex items-center gap-2">
                <i class="bi bi-megaphone"></i> Announcements
            </h3>
            {% if user.role == 'teacher' and class.teacher == user %}
            <a href="{% url 'academics:create_announcement' class.id %}" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm">
                + New
            </a>
            {% endif %}
        </div>
        <div class="p-6">
            {% if announcements %}
                <div class="space-y-3">
                {% for announcement in announcements %}
                <div class="p-4 border-l-4 {% if announcement.priority == 'urgent' %}border-red-500 bg-red-50{% else %}border-blue-500 bg-blue-50{% endif %} rounded-r-lg hover:shadow-md transition">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <h6 class="font-semibold text-gray-800">{{ announcement.title }}</h6>
                                {% if announcement.priority == 'urgent' %}
                                <span class="px-2 py-1 bg-red-600 text-white rounded text-xs">URGENT</span>
                                {% endif %}
                            </div>
                            <p class="text-gray-700 mb-2">{{ announcement.content }}</p>
                            <small class="text-gray-500">{{ announcement.author.get_full_name }} â€¢ {{ announcement.created_at|date:"M d, Y" }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">No announcements yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- Class Materials Section -->
    <div class="bg-white rounded-lg shadow">
        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-lg font-semibold flex items-center gap-2">
                <i class="bi bi-file-earmark"></i> Class Materials
            </h3>
            {% if user.role == 'teacher' and class.teacher == user %}
            <a href="{% url 'academics:upload_material' class.id %}" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm">
                + Upload
            </a>
            {% endif %}
        </div>
        <div class="p-6">
            {% if materials %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {% for material in materials %}
                <div class="p-4 border rounded-lg hover:shadow-md hover:border-purple-300 transition group">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="bi bi-file-earmark-pdf text-2xl text-purple-600"></i>
                                <div>
                                    <a href="{{ material.file.url }}" target="_blank" class="font-semibold text-gray-800 hover:text-purple-600">
                                        {{ material.title }}
                                    </a>
                                    {% if material.description %}
                                    <p class="text-sm text-gray-600">{{ material.description }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            <small class="text-gray-500">{{ material.uploaded_at|date:"M d, Y" }}</small>
                        </div>
                        <div class="flex gap-2">
                            <a href="{{ material.file.url }}" download class="bg-purple-600 text-white p-2 rounded-lg hover:bg-purple-700 transition">
                                <i class="bi bi-download"></i>
                            </a>
                            {% if user.role == 'teacher' and class.teacher == user %}
                            <a href="{% url 'academics:delete_material' material.id %}" 
                               class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700 transition"
                               onclick="return confirm('Delete this material?')">
                                <i class="bi bi-trash"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">No materials uploaded yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- Class Roster Section -->
    <div class="bg-white rounded-lg shadow">
        <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-lg font-semibold flex items-center gap-2">
                <i class="bi bi-people"></i> Class Roster ({{ class.students.count }})
            </h3>
            {% if user.role == 'teacher' and class.teacher == user %}
            <a href="{% url 'academics:manage_students' class.id %}" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm">
                Manage
            </a>
            {% endif %}
        </div>
        <div class="p-6">
            {% if class.students.all %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                    {% for student in class.students.all %}
                    <div class="p-4 border rounded-lg hover:shadow-md hover:border-green-300 transition group">
                        <div class="flex items-center gap-3">
                            <div class="bg-green-100 p-3 rounded-full group-hover:bg-green-200 transition">
                                <i class="bi bi-person text-2xl text-green-600"></i>
                            </div>
                            <div>
                                <strong class="text-gray-800">{{ student.get_full_name }}</strong>
                                <p class="text-sm text-gray-600">{{ student.email }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">No students enrolled yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- Assignments Section -->
    <div class="bg-white rounded-lg shadow">
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-lg font-semibold flex items-center gap-2">
                <i class="bi bi-clipboard-check"></i> Assignments
            </h3>
            {% if user.role == 'teacher' and class.teacher == user %}
            <a href="{% url 'academics:create_assignment' class.id %}" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm">
                + Create
            </a>
            {% endif %}
        </div>
        <div class="p-6">
            {% if assignments %}
                <div class="space-y-3">
                {% for assignment in assignments %}
                <div class="p-4 border rounded-lg hover:shadow-md hover:border-blue-300 transition">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h6 class="font-semibold text-gray-800 mb-1">{{ assignment.title }}</h6>
                            <p class="text-sm text-gray-600 mb-2">{{ assignment.description|truncatewords:20 }}</p>
                            <div class="flex items-center gap-4 text-sm text-gray-500">
                                <span><i class="bi bi-calendar mr-1"></i>{{ assignment.due_date|date:"M d, Y" }}</span>
                                <span><i class="bi bi-trophy mr-1"></i>{{ assignment.total_points }} pts</span>
                            </div>
                        </div>
                        <div>
                            {% if user.role == 'teacher' %}
                                <a href="{% url 'academics:view_submissions' class.id assignment.id %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition inline-flex items-center gap-2">
                                    <i class="bi bi-eye"></i> View
                                </a>
                            {% elif user.role == 'student' %}
                                {% if assignment.has_submission %}
                                    <a href="{% url 'academics:submit_assignment' assignment.id %}" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition inline-flex items-center gap-2">
                                        <i class="bi bi-arrow-repeat"></i> Re-submit
                                    </a>
                                {% else %}
                                    <a href="{% url 'academics:submit_assignment' assignment.id %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition inline-flex items-center gap-2">
                                        <i class="bi bi-upload"></i> Submit
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">No assignments yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
