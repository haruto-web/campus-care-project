{% extends 'base.html' %}

{% block title %}My Assignments{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="bi bi-clipboard-check mr-2"></i>My Assignments
        </h2>

        <!-- Tabs -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="flex space-x-8">
                <button onclick="showTab('upcoming')" id="tab-upcoming" class="tab-button py-4 px-1 border-b-2 border-blue-600 font-semibold text-blue-600">
                    Upcoming ({{ upcoming_count }})
                </button>
                <button onclick="showTab('overdue')" id="tab-overdue" class="tab-button py-4 px-1 border-b-2 border-transparent font-semibold text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Overdue ({{ overdue_count }})
                </button>
                <button onclick="showTab('completed')" id="tab-completed" class="tab-button py-4 px-1 border-b-2 border-transparent font-semibold text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Completed ({{ completed_count }})
                </button>
            </nav>
        </div>

        <!-- Upcoming Assignments -->
        <div id="content-upcoming" class="tab-content">
            {% if upcoming_assignments %}
                <div class="space-y-4">
                {% for assignment in upcoming_assignments %}
                    <div class="p-6 border rounded-lg hover:bg-gray-50 transition">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ assignment.title }}</h3>
                                <p class="text-gray-600 mb-3">{{ assignment.description }}</p>
                                <div class="flex items-center gap-4 text-sm text-gray-500">
                                    <span><i class="bi bi-book mr-1"></i>{{ assignment.class_obj.code }}</span>
                                    <span><i class="bi bi-calendar mr-1"></i>Due: {{ assignment.due_date|date:"M d, Y - g:i A" }}</span>
                                    <span><i class="bi bi-trophy mr-1"></i>{{ assignment.total_points }} points</span>
                                </div>
                            </div>
                            <div class="text-right">
                                {% if assignment.submission %}
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">Submitted</span>
                                {% else %}
                                    <a href="{% url 'academics:submit_assignment' assignment.id %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition inline-block">
                                        Submit
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        {% if assignment.submission %}
                        <div class="mt-4 pt-4 border-t">
                            <p class="text-sm text-gray-600">
                                <i class="bi bi-check-circle text-green-600 mr-1"></i>
                                Submitted on {{ assignment.submission.submitted_at|date:"M d, Y - g:i A" }}
                            </p>
                            {% if assignment.submission.score is not None %}
                            <p class="text-sm text-gray-600 mt-1">
                                <i class="bi bi-trophy text-yellow-600 mr-1"></i>
                                Score: {{ assignment.submission.score }}/{{ assignment.total_points }}
                            </p>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="bi bi-clipboard-check text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No upcoming assignments.</p>
                </div>
            {% endif %}
        </div>

        <!-- Overdue Assignments -->
        <div id="content-overdue" class="tab-content hidden">
            {% if overdue_assignments %}
                <div class="space-y-4">
                {% for assignment in overdue_assignments %}
                    <div class="p-6 border border-red-300 bg-red-50 rounded-lg">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ assignment.title }}</h3>
                                <p class="text-gray-600 mb-3">{{ assignment.description }}</p>
                                <div class="flex items-center gap-4 text-sm text-gray-500">
                                    <span><i class="bi bi-book mr-1"></i>{{ assignment.class_obj.code }}</span>
                                    <span class="text-red-600"><i class="bi bi-exclamation-triangle mr-1"></i>Overdue: {{ assignment.due_date|date:"M d, Y" }}</span>
                                    <span><i class="bi bi-trophy mr-1"></i>{{ assignment.total_points }} points</span>
                                </div>
                            </div>
                            <div class="text-right">
                                {% if assignment.submission %}
                                    <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-semibold">Late Submission</span>
                                {% else %}
                                    <a href="{% url 'academics:submit_assignment' assignment.id %}" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition inline-block">
                                        Submit Late
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        {% if assignment.submission %}
                        <div class="mt-4 pt-4 border-t border-red-200">
                            <p class="text-sm text-gray-600">
                                <i class="bi bi-check-circle text-yellow-600 mr-1"></i>
                                Submitted on {{ assignment.submission.submitted_at|date:"M d, Y - g:i A" }} (Late)
                            </p>
                            {% if assignment.submission.score is not None %}
                            <p class="text-sm text-gray-600 mt-1">
                                <i class="bi bi-trophy text-yellow-600 mr-1"></i>
                                Score: {{ assignment.submission.score }}/{{ assignment.total_points }}
                            </p>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="bi bi-check-circle text-6xl text-green-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No overdue assignments. Great job!</p>
                </div>
            {% endif %}
        </div>

        <!-- Completed Assignments -->
        <div id="content-completed" class="tab-content hidden">
            {% if completed_assignments %}
                <div class="space-y-4">
                {% for assignment in completed_assignments %}
                    <div class="p-6 border rounded-lg">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ assignment.title }}</h3>
                                <p class="text-gray-600 mb-3">{{ assignment.description }}</p>
                                <div class="flex items-center gap-4 text-sm text-gray-500 mb-3">
                                    <span><i class="bi bi-book mr-1"></i>{{ assignment.class_obj.code }}</span>
                                    <span><i class="bi bi-calendar mr-1"></i>Due: {{ assignment.due_date|date:"M d, Y" }}</span>
                                    <span><i class="bi bi-trophy mr-1"></i>{{ assignment.total_points }} points</span>
                                </div>
                                {% if assignment.submission %}
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm text-gray-600">
                                            <i class="bi bi-check-circle text-green-600 mr-1"></i>
                                            Submitted: {{ assignment.submission.submitted_at|date:"M d, Y" }}
                                        </span>
                                        {% if assignment.submission.score is not None %}
                                        {% with percentage=assignment.submission.score|floatformat:0|add:'0' total=assignment.total_points|floatformat:0|add:'0' %}
                                        {% if percentage >= 90 %}
                                        <span class="text-lg font-bold text-green-600">
                                        {% elif percentage >= 70 %}
                                        <span class="text-lg font-bold text-yellow-600">
                                        {% else %}
                                        <span class="text-lg font-bold text-red-600">
                                        {% endif %}
                                            {{ assignment.submission.score }}/{{ assignment.total_points }}
                                        </span>
                                        {% endwith %}
                                        {% else %}
                                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Pending Grade</span>
                                        {% endif %}
                                    </div>
                                    {% if assignment.submission.feedback %}
                                    <div class="mt-2 pt-2 border-t">
                                        <p class="text-sm font-semibold text-gray-700 mb-1">Teacher Feedback:</p>
                                        <p class="text-sm text-gray-600">{{ assignment.submission.feedback }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="bi bi-clipboard-x text-6xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No completed assignments yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Remove active styling from all tabs
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-blue-600', 'text-blue-600');
        button.classList.add('border-transparent', 'text-gray-500');
    });
    
    // Show selected tab content
    document.getElementById('content-' + tabName).classList.remove('hidden');
    
    // Add active styling to selected tab
    const activeTab = document.getElementById('tab-' + tabName);
    activeTab.classList.remove('border-transparent', 'text-gray-500');
    activeTab.classList.add('border-blue-600', 'text-blue-600');
}
</script>
{% endblock %}
